<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "mybatis-3-mapper.dtd">

<mapper namespace="com.msa.kyj_prj.club.ClubDAO">

    <!-- Club 엔티티 매핑 -->
    <resultMap id="clubResultMap" type="com.msa.kyj_prj.club.Club">
        <id property="clubId" column="club_id"/>
        <result property="clubName" column="club_name"/>
        <result property="leaderUserId" column="leader_user_id"/>
        <result property="logoPath" column="logo_path"/>
        <result property="rating" column="rating"/>
        <result property="ranking" column="ranking"/>
        <result property="winCount" column="win_count"/>
        <result property="drawCount" column="draw_count"/>
        <result property="lossCount" column="loss_count"/>
        <result property="description" column="description"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- 단건 조회 -->
    <select id="getClub" resultMap="clubResultMap" parameterType="int">
        SELECT * FROM tbl_club WHERE club_id = #{clubId}
    </select>

    <!-- 등록 -->
    <insert id="insert" parameterType="com.msa.kyj_prj.club.Club" useGeneratedKeys="true" keyProperty="clubId">
        INSERT INTO tbl_club (
            club_name, leader_user_id, logo_path, rating,
            ranking, win_count, draw_count, loss_count,
            description, created_at
        ) VALUES (
            #{clubName}, #{leaderUserId}, #{logoPath}, #{rating},
            #{ranking}, #{winCount}, #{drawCount}, #{lossCount},
            #{description}, NOW()
        )
    </insert>

    <!-- 수정 -->
    <update id="update" parameterType="com.msa.kyj_prj.club.Club">
        UPDATE tbl_club SET
            club_name = #{clubName},
            leader_user_id = #{leaderUserId},
            logo_path = #{logoPath},
            rating = #{rating},
            ranking = #{ranking},
            win_count = #{winCount},
            draw_count = #{drawCount},
            loss_count = #{lossCount},
            description = #{description}
        WHERE club_id = #{clubId}
    </update>

    <!-- 삭제 -->
    <delete id="delete" parameterType="int">
        DELETE FROM tbl_club WHERE club_id = #{clubId}
    </delete>

    <!-- 전체 목록 (검색 + 페이징 + 정렬 포함) -->
    <select id="list" parameterType="map" resultMap="clubResultMap">
        SELECT * FROM tbl_club
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                club_name LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
        </where>
        ORDER BY
        <choose>
            <when test="sortColumn == 'rating'">rating</when>
            <when test="sortColumn == 'ranking'">ranking</when>
            <when test="sortColumn == 'club_name'">club_name</when>
            <otherwise>ranking</otherwise>
        </choose>
        <choose>
            <when test="sortDirection == 'DESC'">DESC</when>
            <otherwise>ASC</otherwise>
        </choose>
        LIMIT #{startRow}, #{pageSize}
    </select>

    <!-- 전체 개수 (검색 포함) -->
    <select id="getTotalCount" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM tbl_club
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                club_name LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
        </where>
    </select>

</mapper>
